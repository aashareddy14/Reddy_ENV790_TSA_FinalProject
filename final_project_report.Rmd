---
title: "Final Project"
author: "Aasha Reddy"
date: "3/16/2022"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE)
```

```{r}
# load libraries
library(lubridate)
library(ggplot2)
library(forecast)  
library(Kendall)
library(tseries)
library(outliers)
library(tidyverse)
library(smooth)
library(sarima)
library(kableExtra)
library(skimr)
```

# Introduction and Objectives 

ADD INTRO AND LITERATURE REVIEW

The objectives for this project will be to assess what type of time series model best represents weather changes in New Delhi. We will also attempt to forecast weather patterns into the future. 


# Data 

The dataset captures daily weather in New Delhi, India from 11/1/1996 to 4/27/2017 for average hourly temperature, wind speed, humidity and mean air pressure. This data comes from kaggle: https://www.kaggle.com/jonathanbouchet/new-delhi-20-years-of-weather-data/data?select=testset.csv. The below table summarizes the data structure.

```{r}
# load data
india_20 <- read.csv("data/india_20.csv")
```

```{r, echo=FALSE}
# clean data with dates, group by hour
in_daily <- india_20 %>%
  mutate(datetime_utc = gsub("-.*", "", datetime_utc), 
         date = ymd(datetime_utc), 
         X_hum = as.numeric(X_hum)) %>%
  group_by(date) %>%
  summarize(temp = mean(X_tempm, na.rm = TRUE), 
            humidity = mean(X_hum, na.rm = TRUE), 
            dew_pt_temp = mean(X_dewptm, na.rm = TRUE), 
            visibility = mean(X_vism, na.rm = TRUE))

# get rid of visibility outlier by swapping it with day before
max_vis <- which.max(in_daily$visibility)
in_daily$visibility[max_vis] <- in_daily$visibility[max_vis - 1]

# aggregate plots daily
#in_daily %>%
#  pivot_longer(cols = 2:5) %>%
#  mutate(name = case_when(
#    name == "temp" ~ "Temperature (Degrees Celcius)", 
#    name == "humidity" ~ "Humidity (%)", 
#    name == "visibility" ~ "Visibility (km)", 
#    name == "dew_pt_temp" ~ "Dew Point Temperature (Degrees Celcius)"
#  )) %>%
#  ggplot(., aes(x = date, y = value)) + 
#  geom_line() + 
#  facet_wrap(~name, scales = "free") + 
#  theme_bw() + 
#  labs(title = "Daily Average Weather in New Delhi (1996 - 2017)", 
#       x = "Year", 
#       y = "")

# clean data with dates, group by month
in_monthly <- india_20 %>%
  mutate(datetime_utc = substr(datetime_utc,1,6), 
         date = ym(datetime_utc), 
         X_hum = as.numeric(X_hum))  %>%
  group_by(date) %>%
  summarize(temp = mean(X_tempm, na.rm = TRUE), 
            humidity = mean(X_hum, na.rm = TRUE), 
            dew_pt_temp = mean(X_dewptm, na.rm = TRUE), 
            visibility = mean(X_vism, na.rm = TRUE))

# get rid of visibility outlier by swapping it with day before
max_vis <- which.max(in_monthly$visibility)
in_monthly$visibility[max_vis] <- in_monthly$visibility[max_vis - 1]
```

```{r}
Unit <- c("Date", "Degrees Celcius", "%", "Degrees Celcius", "Km")
Min <- apply(in_monthly, 2, min)
Max <- apply(in_monthly, 2, max)
Mean <- c("--", round(mean(in_monthly$temp), 2), 
          round(mean(in_monthly$humidity), 2), 
          round(mean(in_monthly$dew_pt_temp), 2), 
          round(mean(in_monthly$visibility), 2))

data.frame(Unit, Min, Max, Mean) %>%
  kbl(., align = "c", 
      caption = "Data Structure Summary")
```

We also show the first 10 rows of the monthly weather data below: 

```{r}
# first 10 rows of data
head(in_monthly, 10) %>%
  kbl(., align = "c", 
      caption = "First 10 rows of Monthly New Delhi Weather Data")
```



# Analysis

## Data Cleaning and Exploratory Analysis 

First we clean the data. The raw data comes in an hourly format, so first we transform to a daily average between 1996 and 2017. We find that these series may be too sensitive, and we also note that daily weather patterns may be of less interest than monthly average weather patterns. Thus, we further transform the data from daily average weather patters to montly average weather patterns. Below we can see the time series for monthly average dew point temperature, humidity, temperature, and visibility in New Delhi between November 1996 to April 2017. 

```{r}
# Aggregate plots monthly 
in_monthly %>%
  pivot_longer(cols = 2:5) %>%
  mutate(name = case_when(
    name == "temp" ~ "Temperature (Degrees Celcius)", 
    name == "humidity" ~ "Humidity (%)", 
    name == "visibility" ~ "Visibility (km)", 
    name == "dew_pt_temp" ~ "Dew Point Temperature (Degrees Celcius)"
  )) %>%
  ggplot(., aes(x = date, y = value)) + 
  geom_line() + 
  facet_wrap(~name, scales = "free") + 
  theme_bw() + 
  labs(title = "Monthly Average Weather in New Delhi (1996 - 2017)", 
       x = "Year", 
       y = "")
```

## Methods and Models

To evaluate what type of time series best represents each weather series, we take November 1996 to March 2016 as a training dataset, with April 2016 to April 2017 as our test dataset. We will then choose a final model based on performance on the test set. We will refit the best model on all data, and forecast weather patterns from May 2017 to May 2030. This is a relatively large forecast period, however, it will be interesting to understand potential weather patterns about 10 years into the future. 

First we will examine the temperature time series. 


# Results 


# Summary and Conclusions